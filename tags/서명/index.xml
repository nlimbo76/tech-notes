<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>서명 on gBear's Tech Notes</title><link>https://nlimbo76.github.io/tech-notes/tags/%EC%84%9C%EB%AA%85/</link><description>Recent content in 서명 on gBear's Tech Notes</description><generator>Hugo -- 0.148.2</generator><language>ko-kr</language><lastBuildDate>Sun, 24 Aug 2025 00:00:00 +0000</lastBuildDate><atom:link href="https://nlimbo76.github.io/tech-notes/tags/%EC%84%9C%EB%AA%85/index.xml" rel="self" type="application/rss+xml"/><item><title>OTA 업데이트 파이프라인과 이미지 서명 (정리판)</title><link>https://nlimbo76.github.io/tech-notes/posts/ota-signed-pipeline/</link><pubDate>Sun, 24 Aug 2025 00:00:00 +0000</pubDate><guid>https://nlimbo76.github.io/tech-notes/posts/ota-signed-pipeline/</guid><description>&lt;h2 id="개요">개요&lt;/h2>
&lt;p>현장 장비의 펌웨어 업데이트(OTA)는 &lt;strong>가용성·보안·복구성&lt;/strong>이 핵심입니다. 이 문서는
&lt;strong>A/B 슬롯 전략 + 서명/무결성 검증 + 점진적 배포&lt;/strong>를 축으로 한 &lt;strong>엔드투엔드 파이프라인&lt;/strong>을 정리합니다.
목표는 &lt;em>“중단 없이, 위변조 없이, 실패해도 자동 복구”&lt;/em> 입니다.&lt;/p>
&lt;hr>
&lt;h2 id="핵심-개념--설계-포인트">핵심 개념 / 설계 포인트&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>서명과 무결성&lt;/strong>: 이미지 &lt;code>SHA-256 해시&lt;/code> + &lt;code>서명(Ed25519/ECDSA)&lt;/code> + &lt;code>메타데이터&lt;/code>를 &lt;strong>번들&lt;/strong>로 관리.&lt;/li>
&lt;li>&lt;strong>A/B 파티션&lt;/strong>: 비활성 슬롯에 다운로드→검증→스위치. 부팅 성공 신호 없으면 &lt;strong>자동 롤백&lt;/strong>.&lt;/li>
&lt;li>&lt;strong>메타데이터(Manifest)&lt;/strong>: 버전, 타깃(보드/SoC), 빌드 타임, 해시, 최소 부트로더/SE 버전, &lt;strong>anti-rollback 카운터&lt;/strong>.&lt;/li>
&lt;li>&lt;strong>전송 보안&lt;/strong>: 서버↔디바이스 &lt;strong>TLS/DTLS&lt;/strong> + 서버 측 &lt;strong>토큰/기기 인증&lt;/strong>. 전송 보안 ≠ 이미지 신뢰.&lt;/li>
&lt;li>&lt;strong>신뢰 루트&lt;/strong>: 부트로더에 &lt;strong>공개키 고정&lt;/strong>(ROM/섹션). 키 교체는 롤링 방식(Trust Anchor version).&lt;/li>
&lt;li>&lt;strong>대상 선정/점진 배포&lt;/strong>: 롤링 퍼센트(1%→10%→50%→100%), 지역/모델/펌웨어 라인업 기반 타겟팅.&lt;/li>
&lt;li>&lt;strong>중단 내성&lt;/strong>: 청크 다운로드 + 재시작 재개 + 이중 버퍼링 + 저널링/원자 스위치.&lt;/li>
&lt;li>&lt;strong>로깅/관측성&lt;/strong>: 기기별 업데이트 이력, 실패코드, 롤백 사유, 배포 cohort 성과.&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="시스템-구성참고-아키텍처">시스템 구성(참고 아키텍처)&lt;/h2>
&lt;pre tabindex="0">&lt;code>Developer → CI(빌드/사인) → Artifact Store(CDN/S3)
│ ↑
└─ Backend(메타/대상선정/토큰) ─→ Device(Agent)
↓
Bootloader(Verify/Swap/Rollback)
&lt;/code>&lt;/pre>&lt;ul>
&lt;li>&lt;strong>CI&lt;/strong>: 펌웨어 빌드, 해시 산출, &lt;strong>오프라인 서명&lt;/strong>(가능하면 HSM).&lt;/li>
&lt;li>&lt;strong>Artifact Store&lt;/strong>: 압축된 펌웨어 + manifest. Range 요청/Resume 지원.&lt;/li>
&lt;li>&lt;strong>Backend&lt;/strong>: 대상 선택, 배포 라운드, 토큰 발급, 통계 수집.&lt;/li>
&lt;li>&lt;strong>Device Agent&lt;/strong>: 다운로드/검증/스위치 요청/헬스체크 보고.&lt;/li>
&lt;li>&lt;strong>Bootloader&lt;/strong>: &lt;strong>유일한 신뢰 판단자&lt;/strong>. 공개키로 manifest+이미지 검증.&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="manifest-포맷예시-json">Manifest 포맷(예시, JSON)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-json" data-lang="json">&lt;span class="line">&lt;span class="cl">&lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;board&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;nx3000&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;soc&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;stm32h7&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;version&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;1.4.3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;build&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;2025-08-20T13:55:21Z&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;min_boot&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">3&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;anti_rollback&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">42&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;image&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;filename&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;app_v1.4.3.bin&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;size&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="mi">524288&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sha256&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;3f5c...ab9d&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">},&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sign&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;alg&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;Ed25519&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;pub_key_id&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;k-2025-q3&amp;#34;&lt;/span>&lt;span class="p">,&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="nt">&amp;#34;sig&amp;#34;&lt;/span>&lt;span class="p">:&lt;/span> &lt;span class="s2">&amp;#34;base64-encoded-signature&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ul>
&lt;li>&lt;code>anti_rollback&lt;/code>: 부트로더 &lt;strong>카운터 &amp;gt;= 값&lt;/strong>이어야 설치 허용.&lt;/li>
&lt;li>&lt;code>pub_key_id&lt;/code>: 키 롤오버 시 버전을 구분(구 키 폐기 시점 통제).&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h2 id="서명-파이프라인오프라인-예시">서명 파이프라인(오프라인 예시)&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1) 해시 생성&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sha256sum app.bin &amp;gt; app.bin.sha256
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2) Ed25519 키 생성(오프라인/보안 저장)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl genpkey -algorithm Ed25519 -out ed25519_priv.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl pkey -in ed25519_priv.pem -pubout -out ed25519_pub.pem
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3) 서명&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl pkeyutl -sign -inkey ed25519_priv.pem -in app.bin -out app.bin.sig
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4) 서명 검증(빌드 서버/테스트)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">openssl pkeyutl -verify -pubin -inkey ed25519_pub.pem -sigfile app.bin.sig -in app.bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;blockquote>
&lt;p>실제 배포에서는 &lt;strong>manifest 전체&lt;/strong>(메타+해시)를 서명하는 방식을 권장.
서명 전용 키는 HSM/YubiKey/전용 키 관리 서버에 보관.&lt;/p></description></item></channel></rss>